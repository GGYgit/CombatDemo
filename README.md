## 说明

键盘操作： WASD移动，鼠标左键攻击，Space闪避 ，Alt跳跃，Shift跑步

手柄操作：左摇杆移动 X攻击 RT闪避 A跳跃 RB跑步

### 基础战斗

- 角色（ICombatEntity）战斗中的实体，仅定义作为一个角色拥有的通用的接口，如取角色组件、造成伤害、位移等。![](imgs/CombatEntity.png)

- Controller ：负责控制角色实体，响应输入、决策行为等。![](imgs/Controller.png)
- 动作系统：触发一个动作时跑配置的动作类逻辑，基于优先级及动作配置决定是否可触发动作类。Demo里因为仅使用几何体，所以没有用引擎的动画系统，是在动作系统内定义了一套解析动画插值数据的功能。
- 运动系统：负责角色位移、寻路等。主角基于引擎自带的CharacterController实现，AI基于NavmeshAgent实现。

### AI

AI行为决策：基于分层状态机与行为序列思想，外层AI状态机拥有待机、巡逻、战斗状态，通过感知组件在状态之间决策切换。在内层战斗状态机基于条件设置切换战斗状态，如近战、远程、观察目标等，基于战斗状态执行配置的行为队列。下图为战斗状态的配置数据结构。![](imgs/CombatConfig.png)



战斗圈：由此系统分配AI的攻击性、站位，协调多个AI的进攻行为。每个AI根据所属圈（等待、接近、近战、远程）进行调度。![战斗圈](imgs/FightCircle.png)

分配所属圈时会提前进行进攻性的评分，评分标准参考：![](imgs/Aggressive.png)





### 为提升战斗爽快感及打击感所做的设计与具体实现方法

该Demo为了战斗爽快感，主要追求弱化玩家需要控制的方位，要求对敌人攻击的反应，只需要走到差不多的位置，差不多的角度，即可开始对敌人连击，但需要较为精准的反应闪躲敌人攻击，抓住机会反击。

##### 具体设计及实现：

- 受击后的冻结帧、特殊动作时的慢动作，该Demo冻结帧都在0.05~0.15s之间，因为追求爽快，快节奏所以把冻结帧设置在这个不太能很明显感受到的区间。通过CombatTimeManagerComponent实现，角色实体初始化时向该组件注册，由时间管理组件控制该角色的TimeScale。

- 受击反馈：摄像机震动、击退、颜色变化、粒子特效、命中点产生四散的几何体。开发了一个受击组件HitEffectComponent，用于挂载受击效果，当受到伤害时角色会尝试取受击组件并调用触发受击效果。

- 动画分段:动作游戏更加依赖表现支持，动作表现与人的直观经验密不可分，所以一些经典的动作过程即使仅使用简单几何体也需要做出明显状态区分，所以把武器动画的分段（前摇、激活、后摇），每个阶段独立控制持续时间及曲线。该Demo玩家攻击前摇时间设置在0.2~0.4之间，该区间比较符合常人从输入攻击到意识画面上的角色产生攻击行为的节奏。

- 动作打断：区分动作优先级，高优先级打断低优先级，如闪避可以在任意时候打断攻击。移动打断，在动作快结束时可以通过移动取消当前动作。

- 攻击武器拖尾效果

- 攻击动作时角色匹配的滑动

- 攻击吸附：玩家攻击时如果附近有满足条件的敌人会产生吸附效果，弱化对玩家控制方位的要求

- 摄像机自动修正：玩家攻击命中时尝试修正摄像机角度到攻击的正面。进一步弱化玩家对控制方位的要求

- 玩家能力：Demo中存在远程AI设计，远程敌人的AI逻辑总结为在一定距离处射击玩家，如玩家靠近则逃离玩家。由此会出现情景玩家被一堆近战敌人包围时，远程的敌人又一直射击，这时玩家会陷入困境很苦恼。在此情景为玩家赋予远距离快速接近远程敌人的能力，由这种制造情景、赋予解决情景难题的能力带来爽感。该Demo中跳跃时输入攻击可以进入空中追击，快速锁定并移动至远处敌人身边进行连击。

  

